# 入口
- 在开发期间，vite是一个服务器，启动之后访问根路径，故根目录下的index.html是项目的入口文件
  - index.html下发现script脚本，则开始请求该资源
    - 每遇见一个import，就会发出一个HTTP请求，vite启动了一个KOA服务器拦截这些请求，并在后端进行相应的处理，以ES6格式返回给浏览器
    - 整个过程实现了按需加载
- 当默认扫描HTML文件的行为无法满足需求的时候（比如.vue文件），可以通过optimizeDeps.entries参数配置
  ```js
  {
    optimizeDeps: {
      entries: []
    }
  }
  ```

## 预构建
- 产生原因和作用
  1. Vite基于浏览器ES模块实现的dev server，无论是应用代码还是第三方依赖代码，都应该符合ESM规范才能运行，故需要对第三方依赖转换成ESM产物
  2. 由于每一个import就是一个请求，对于第三方依赖（loadsh-es库）可能产生请求瀑布流，故需要将各个第三库分散的文件合并在一起，减少HTTP请求
  - 由ESBuild实现，没有明显打包性能

# 添加依赖
- 由于Vite天然的按需加载，对于动态import只有运行时才能识别，容易导致二次预构建，通过optimizeDeps.include将其包含进来
  - 二次预构建的成本也比较大。我们不仅需要把预构建的流程重新运行一遍，还得重新刷新页面，并且需要重新请求所有的模块

# 插件
- 作用
  1. 代码转换、代码优化
  2. 添加新功能、与其他工具集成
- 原理
  1. 被设计为一个对象，含有name插件名称和setup函数，该函数接收build对象，对象挂载了一些钩子供实现自定义逻辑
- 用法
  1. onResolve钩子和onLoad钩子，分别控制路径解析和模块内容加载
  2. onStart和OnEnd钩子，分别用来构建开启和结束时候执行
  3. 其他钩子